<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eric's Station</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        /* === Ê†∏ÂøÉÊ†∑Âºè === */
        :root { --primary: #4834d4; --secondary: #686de0; --bg: #f5f6fa; --text: #2c3e50; --white: #ffffff; --sidebar-width: 220px; --success: #6ab04c; --danger: #eb4d4b; }
        body { font-family: "Segoe UI", sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* ‰æßËæπÊ†è */
        .sidebar { width: var(--sidebar-width); background: linear-gradient(180deg, var(--primary), var(--secondary)); color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 100; }
        .app-logo { font-size: 20px; font-weight: bold; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .avatar { width: 36px; height: 36px; background: white; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .day-picker label { font-size: 12px; opacity: 0.8; display: block; margin-bottom: 5px; }
        .day-picker select { width: 100%; padding: 8px; border-radius: 5px; border: none; font-weight: bold; margin-bottom: 20px; cursor: pointer; }
        .nav-btn { background: rgba(255,255,255,0.1); border: none; color: rgba(255,255,255,0.8); padding: 15px; margin-bottom: 10px; border-radius: 12px; text-align: left; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .nav-btn.active { background: white; color: var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        /* ‰∏ªÂÜÖÂÆπ */
        .main-content { flex: 1; overflow-y: auto; padding: 20px; position: relative; -webkit-overflow-scrolling: touch; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dashboard */
        .dashboard-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 15px; }
        th { background: #dfe4ea; padding: 10px; white-space: nowrap; }
        td { border-bottom: 1px solid #eee; padding: 8px; text-align: center; }
        .sig-input { border:none; border-bottom:1px solid #ccc; width:50px; text-align:center; color:var(--primary); font-family:monospace; }
        .check-box { transform: scale(1.2); cursor: pointer; }

        /* Study Room */
        .study-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; min-height: 500px; display: flex; flex-direction: column; }
        .study-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f1f2f6; padding-bottom: 15px; }
        .passage-text { font-size: 18px; line-height: 1.8; color: #34495e; margin-bottom: 20px; white-space: pre-wrap; }
        .vocab-hl { color: #d35400; font-weight: bold; background: #fff5e6; padding: 0 4px; border-radius: 4px; }
        .translation-box { background: #f1f2f6; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); display: none; margin-top: 15px; color: #666; font-size: 16px; }
        .study-container.show-trans .translation-box { display: block; }
        .audio-controls { display: flex; gap: 15px; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .btn { padding: 8px 20px; border-radius: 20px; border: none; cursor: pointer; font-weight: bold; color: white; }
        .listen-item { background: #f8f9fa; border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: auto; padding-top: 20px; }
        .page-btn { background: white; border: 1px solid #ccc; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        .page-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Game Center */
        .game-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .game-btn { background: white; border: 1px solid #eee; padding: 10px 25px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .game-btn.active { background: var(--primary); color: white; }
        .game-area { background: white; border-radius: 20px; padding: 30px; min-height: 450px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        
        /* Game Elements */
        .flashcard-scene { perspective: 1000px; width: 320px; height: 220px; cursor: pointer; margin-bottom: 20px; }
        .flashcard { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .flashcard.flipped { transform: rotateY(180deg); }
        .fc-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 800; border-radius: 20px; background: white; border: 1px solid #eee; }
        .fc-front { color: var(--primary); } .fc-back { background: var(--primary); color: white; transform: rotateY(180deg); }
        
        .match-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; max-width: 700px; }
        .match-card { background: #f8f9fa; padding: 5px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 600; height: 70px; display: flex; align-items: center; justify-content: center; border: 2px solid transparent; user-select: none; transition: 0.15s; font-size: 14px; }
        .match-card.selected { border-color: var(--primary); background: #eeeaf9; color: var(--primary); transform: scale(1.05); }
        .match-card.crush { opacity: 0; transform: scale(0); transition: 0.4s; pointer-events: none; }
        .spell-input { width: 60%; padding: 12px; font-size: 24px; text-align: center; border: 2px solid #ddd; border-radius: 12px; margin: 20px 0; outline: none; font-family: monospace; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="app-logo"><div class="avatar">EC</div> Eric's Station</div>
    <div class="day-picker">
        <label>Select Day:</label>
        <select id="globalDaySelect" onchange="changeGlobalDay()"></select>
    </div>
    <button class="nav-btn active" onclick="showSection('dashboard', this)">üìä ÊåáÊå•ÂÆò</button>
    <button class="nav-btn" onclick="showSection('study', this)">üìñ Ê†∏ÂøÉËÆ≠ÁªÉ</button>
    <button class="nav-btn" onclick="showSection('game', this)">üéÆ Á´ûÊäÄÂú∫</button>
</div>

<div class="main-content">
    <div id="dashboard" class="section active">
        <div class="dashboard-card">
            <h2 style="color:var(--primary); margin-top:0;">üõ°Ô∏è KET ÊåáÊå•ÂÆò</h2>
            <p>Score: <span id="totalPoints" style="font-weight:bold; color:#f0932b">0</span></p>
            <div style="overflow-x:auto;"><table style="min-width:600px;"><thead><tr><th>Day</th><th>ÂçïËØç</th><th>Âê¨ËØª</th><th>ÂÜô/ËØ¥</th><th>App</th><th>Â§ç‰π†</th><th>ÂæóÂàÜ</th><th>Á≠æÂ≠ó</th></tr></thead><tbody id="dashBody"></tbody></table></div>
        </div>
    </div>

    <div id="study" class="section">
        <div class="study-container">
            <div class="study-header"><h2 style="margin:0; color:var(--primary);" id="studyTitle">Day X</h2><button onclick="toggleTrans()" style="background:#f0932b; color:white; border:none; padding:8px 15px; border-radius:15px; cursor:pointer;">üëÅÔ∏è ÁøªËØë</button></div>
            <div id="studyContent"></div><div class="pagination" id="studyPagination"></div>
        </div>
    </div>

    <div id="game" class="section">
        <div class="game-nav">
            <button class="game-btn active" onclick="setGameMode('flashcard', this)">‚ö° Èó™Âç°</button>
            <button class="game-btn" onclick="setGameMode('match', this)">üß© ËøûËøûÁúã</button>
            <button class="game-btn" onclick="setGameMode('spell', this)">‚úçÔ∏è ÊãºÂÜô</button>
        </div>
        <div class="game-area" id="gameBoard"></div>
    </div>
</div>

<script src="ket_data.js"></script>
<script>
    let currentDay = 1;
    let currentData = null;
    let gameState = { mode: 'flashcard', idx: 0, match: { selected: [], correct: 0, wrong: 0 } };

    window.onload = function() {
        const sel = document.getElementById('globalDaySelect');
        for(let i=1; i<=14; i++) {
            let opt = document.createElement('option'); opt.value = i; opt.innerText = `Day ${i}`; sel.appendChild(opt);
        }
        loadDayData(1);
        genTable();
    };

    function changeGlobalDay() { loadDayData(parseInt(document.getElementById('globalDaySelect').value)); }

    function loadDayData(day) {
        currentDay = day;
        currentData = KET_DATA[day];
        if(!currentData) { alert("Day " + day + " ÊöÇÊó†Êï∞ÊçÆÔºåÂä†ËΩΩ Day 1 ÊºîÁ§∫„ÄÇ"); currentData = KET_DATA[1]; }
        document.getElementById('studyTitle').innerText = `Day ${day}: ${currentData.theme}`;
        if(document.getElementById('study').classList.contains('active')) renderStudyPage(0);
        if(document.getElementById('game').classList.contains('active')) renderGame();
    }

    function showSection(id, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(btn) { document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active')); btn.classList.add('active'); }
        if(id === 'study') renderStudyPage(0);
        if(id === 'game') renderGame();
        window.speechSynthesis.cancel();
    }

    function genTable() {
        const tbody = document.getElementById('dashBody'); tbody.innerHTML = ''; let total = 0;
        for(let i=1; i<=14; i++) {
            let done = localStorage.getItem(`d${i}_done`); let score = done ? 10 : 0; total += score;
            tbody.innerHTML += `<tr><td style="font-weight:bold;">Day ${i}</td><td><input type="checkbox" ${done?'checked':''} class="check-box" onchange="saveDash(${i}, this)"></td><td><input type="checkbox" class="check-box"></td><td><input type="number" class="sig-input"></td><td><input type="checkbox" class="check-box"></td><td>${i%3===0 ? 'üîµ' : '-'}</td><td style="color:var(--primary); font-weight:bold;">${score}</td><td><input type="text" class="sig-input"></td></tr>`;
        }
        document.getElementById('totalPoints').innerText = total;
    }
    function saveDash(day, el) { if(el.checked) localStorage.setItem(`d${day}_done`, 1); else localStorage.removeItem(`d${day}_done`); genTable(); }

    function renderStudyPage(pageIdx) {
        const container = document.getElementById('studyContent'); const pagination = document.getElementById('studyPagination');
        let pages = (currentData.reading || []).concat(currentData.listening ? [{ type: 'listening', title: 'Listening Practice', content: currentData.listening }] : []);
        let p = pages[pageIdx]; let html = '';

        if(p.type === 'listening') {
            html += `<h3>${p.title}</h3>`;
            p.content.forEach(item => { html += `<div class="listen-item"><div style="display:flex; justify-content:space-between; align-items:center;"><span>${item.text}</span><button onclick="speak('${item.audioText}')" style="background:var(--primary); color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;">üîä</button></div><div class="translation-box">[ËØë] ${item.translation}</div></div>`; });
        } else {
            html += `<h3>${p.title}</h3><div class="passage-text" id="readText">${p.content}</div><div class="translation-box"><strong>[ËØë]</strong><br>${p.translation}</div><div class="audio-controls"><button class="btn" style="background:var(--success); color:white" onclick="speak(document.getElementById('readText').innerText)">‚ñ∂ ÊúóËØª</button><button class="btn" style="background:var(--danger); color:white" onclick="window.speechSynthesis.cancel()">‚ñ† ÂÅúÊ≠¢</button></div>`;
        }
        container.innerHTML = html;
        let btnHtml = ''; pages.forEach((_, idx) => { btnHtml += `<button class="page-btn ${idx===pageIdx?'active':''}" onclick="renderStudyPage(${idx})">${idx+1}</button>`; });
        pagination.innerHTML = btnHtml;
    }

    function toggleTrans() { const pwd = prompt("Password (777):"); if(pwd === "777") document.querySelector('.study-container').classList.toggle('show-trans'); }
    function speak(txt) { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(txt); u.lang = 'en-GB'; u.rate = 0.9; window.speechSynthesis.speak(u); }

    function setGameMode(mode, btn) { gameState.mode = mode; gameState.idx = 0; document.querySelectorAll('.game-btn').forEach(el => el.classList.remove('active')); if(btn) btn.classList.add('active'); renderGame(); }
    function renderGame() {
        const board = document.getElementById('gameBoard'); board.innerHTML = ''; const vocab = currentData.vocab;
        if(gameState.mode === 'flashcard') {
            let w = vocab[gameState.idx];
            board.innerHTML = `<div style="color:#888; margin-bottom:10px;">${gameState.idx+1} / ${vocab.length}</div><div class="flashcard-scene" onclick="this.querySelector('.flashcard').classList.toggle('flipped'); speak('${w.en}')"><div class="flashcard"><div class="fc-face fc-front">${w.en}</div><div class="fc-face fc-back">${w.cn}</div></div></div><div style="display:flex; gap:20px;"><button class="game-btn" onclick="if(gameState.idx>0){gameState.idx--; renderGame()}">Prev</button><button class="game-btn" onclick="if(gameState.idx<${vocab.length-1}){gameState.idx++; renderGame()}">Next</button></div>`;
        } else if(gameState.mode === 'match') {
            if(!gameState.matchInit || gameState.lastDay !== currentDay) {
                let deck = []; let slice = vocab.length > 8 ? vocab.slice(0,8) : vocab;
                slice.forEach((v,i)=> { deck.push({id:i, type:'en', t:v.en}); deck.push({id:i, type:'cn', t:v.cn}); });
                deck.sort(()=>0.5-Math.random()); gameState.matchDeck = deck; gameState.match.selected = []; gameState.match.correct = 0; gameState.matchInit = true; gameState.lastDay = currentDay;
            }
            let html = `<div class="match-stats"><div class="stat-badge" style="color:green">‚úÖ: <span id="m_c">${gameState.match.correct}</span></div></div><div class="match-grid">`;
            gameState.matchDeck.forEach((c, i) => { html += `<div class="match-card" id="card_${i}" onclick="handleMatch(${i}, '${c.type}', ${c.id}, '${c.t}')">${c.t}</div>`; });
            html += `</div><button class="game-btn" style="margin-top:20px" onclick="gameState.matchInit=false; renderGame()">Restart</button>`;
            board.innerHTML = html;
        } else if(gameState.mode === 'spell') {
            let w = vocab[gameState.idx];
            board.innerHTML = `<h2 style="color:var(--primary); font-size:32px;">${w.cn}</h2><input id="spellIn" class="spell-input" placeholder="..." autocomplete="off"><div id="fb" style="height:20px; font-weight:bold; margin-bottom:10px;"></div><button class="game-btn" onclick="checkSpell('${w.en}')">Check</button>`;
            setTimeout(() => { const inp = document.getElementById('spellIn'); if(inp) { inp.focus(); inp.onkeypress = (e) => { if(e.key === 'Enter') checkSpell(w.en); } } }, 100);
        }
    }

    function handleMatch(idx, type, id, text) {
        let el = document.getElementById(`card_${idx}`); if(el.style.opacity === '0' || el.classList.contains('selected')) return;
        if(type === 'en') speak(text); el.classList.add('selected'); gameState.match.selected.push({idx, id, el});
        if(gameState.match.selected.length === 2) {
            let [c1, c2] = gameState.match.selected;
            if(c1.id === c2.id && c1.idx !== c2.idx) { setTimeout(()=>{ c1.el.style.opacity=0; c2.el.style.opacity=0; }, 300); gameState.match.correct++; document.getElementById('m_c').innerText = gameState.match.correct; } 
            else { c1.el.classList.add('shake'); c2.el.classList.add('shake'); setTimeout(()=>{ c1.el.classList.remove('selected','shake'); c2.el.classList.remove('selected','shake'); }, 500); }
            gameState.match.selected = [];
        }
    }
    function checkSpell(ans) {
        let val = document.getElementById('spellIn').value.trim();
        if(val.toLowerCase() === ans.toLowerCase()) { document.getElementById('fb').innerHTML = "<span style='color:green'>Correct!</span>"; speak(ans); setTimeout(()=>{ if(gameState.idx < currentData.vocab.length-1) { gameState.idx++; renderGame(); } else alert("All words cleared!"); }, 1000); } 
        else { document.getElementById('fb').innerHTML = "<span style='color:red'>Try again</span>"; document.getElementById('spellIn').value = ""; document.getElementById('spellIn').focus(); }
    }
</script>
</body>
</html>